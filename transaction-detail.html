<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transaction Detail</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0 12px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('bg3.jpeg') no-repeat center center fixed;
      background-size: cover;
      color: #ddd; display: flex;
      justify-content: center; align-items: center;
      min-height: 100vh; position: relative;
    }
    body::before {
      content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.65); z-index: 0;
    }
    .card {
      backdrop-filter: blur(14px);
      background: rgba(30, 30, 30, 0.9);
      padding: 24px 20px;
      border-radius: 18px;
      width: 100%;
      max-width: 440px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 1;
    }
    h2 {
      text-align: center;
      font-size: 22px;
      margin-bottom: 16px;
      color: #fff;
    }
    h2::after {
      content: ''; display: block;
      height: 3px; width: 40px;
      background: #ffb347;
      margin: 8px auto 0;
      border-radius: 2px;
    }
    .field-card {
      background: rgba(50, 50, 50, 0.85);
      border: 1px solid #444;
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .form-group { display: flex; flex-direction: column; }
    label {
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 14px;
      color: #eee;
    }
    input, textarea {
      background: #1f1f1f;
      color: #eee;
      border: 1px solid #444;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 15px;
    }
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    button {
      flex: 1 1 30%;
      min-width: 90px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
    }
    .edit-btn { background: #ffb347; color: black; }
    .save-btn { background: #4caf50; color: white; }
    .delete-btn { background: #e53935; color: white; }
    .back-btn {
      display: block;
      text-align: center;
      margin: 24px auto 0;
      padding: 10px 16px;
      background: #555;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Transaction Detail</h2>
    <div class="field-card"><div class="form-group"><label>Product Name</label><input type="text" id="name" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label>Stock</label><input type="number" id="stock" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label>Price</label><input type="number" id="price" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label>Category</label><input type="text" id="category" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label id="partyLabel">Party</label><input type="text" id="party" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label>Date</label><input type="date" id="date" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label>Time</label><input type="time" id="time" disabled /></div></div>
    <div class="field-card"><div class="form-group"><label>Transport Details</label><textarea id="TransportDetails" disabled></textarea></div></div>

    <div class="btn-group">
      <button class="edit-btn" onclick="enableEdit()">Edit</button>
      <button class="save-btn" onclick="saveTransaction()" disabled>Save</button>
      <button class="delete-btn" onclick="deleteTransaction()">Delete</button>
    </div>
    <a href="transactions.html" class="back-btn">‚Üê Back to Transactions</a>
  </div>

  <script>
    let tx = null;
    try {
      tx = JSON.parse(localStorage.getItem('currentTransaction'));
    } catch { tx = null; }

    if (!tx) {
      alert('No transaction data found!');
      location.href = 'transactions.html';
    }

    const isStockIn = tx.type === 'in';
    document.getElementById('partyLabel').textContent = isStockIn ? 'Supplier Name' : 'Customer Name';

    function fillInputs(data) {
      document.getElementById('name').value = data.name || '';
      document.getElementById('stock').value = data.items || '';
      document.getElementById('price').value = data.price || '';
      document.getElementById('category').value = data.category || '';
      document.getElementById('party').value = isStockIn ? (data.supplier || '') : (data.customer || '');
      document.getElementById('date').value = data.date || '';
      document.getElementById('time').value = data.time || '';
      document.getElementById('TransportDetails').value = data.TransportDetails || '';
    }

    fillInputs(tx);

    function enableEdit() {
      ['name', 'stock', 'price', 'category', 'party', 'date', 'time', 'TransportDetails'].forEach(id => {
        document.getElementById(id).disabled = false;
      });
      document.querySelector('.save-btn').disabled = false;
      document.querySelector('.edit-btn').disabled = true;
    }

    function saveTransaction() {
      let transactions = JSON.parse(localStorage.getItem('addedTransactions')) || [];
      transactions = transactions.filter(t => !(t.name === tx.name && t.date === tx.date && t.time === tx.time && t.type === tx.type));

      const updatedTx = {
        ...tx,
        name: document.getElementById('name').value.trim(),
        items: parseInt(document.getElementById('stock').value),
        price: parseFloat(document.getElementById('price').value),
        category: document.getElementById('category').value.trim(),
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        TransportDetails: document.getElementById('TransportDetails').value.trim()
      };

      if (isStockIn) {
        updatedTx.supplier = document.getElementById('party').value.trim();
        delete updatedTx.customer;
      } else {
        updatedTx.customer = document.getElementById('party').value.trim();
        delete updatedTx.supplier;
      }

      transactions.push(updatedTx);
      localStorage.setItem('addedTransactions', JSON.stringify(transactions));
      alert('Transaction saved!');
      window.location.href = 'transactions.html';
    }

    function deleteTransaction() {
      if (!confirm('Are you sure you want to delete this transaction?')) return;
      let transactions = JSON.parse(localStorage.getItem('addedTransactions')) || [];
      transactions = transactions.filter(t => !(t.name === tx.name && t.date === tx.date && t.time === tx.time && t.type === tx.type));
      localStorage.setItem('addedTransactions', JSON.stringify(transactions));
      alert('Transaction deleted.');
      window.location.href = 'transactions.html';
    }
  </script>
</body>
</html>
